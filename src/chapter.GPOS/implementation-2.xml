<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<section role="implementation">
      <title>Implementation</title>
      <para>We have a class that represents a
          <ottable>GPOS</ottable> table and provides the approriate
          operations.</para>
      <code-fragment package="com.adobe.aots.CommonType" class="Gpos"><code-title>GPOS Class</code-title>
package com.adobe.aots.CommonType;

import java.util.Map;
import java.util.HashMap;
import java.util.SortedMap;
import java.util.TreeMap;
import java.util.Iterator;

import org.w3c.dom.Element;
import org.w3c.dom.NodeList;
import org.xml.sax.helpers.AttributesImpl;

import com.adobe.aots.util.ContentHandlerPlus;

public class Gpos extends LookupTable {

  public Gpos () {
    super (Tag.GPOS, null);
  }

  public Gpos (Font font) {
    super (Tag.GPOS, font);
  }

  public int[] getTableVersion () {
    return getFixed (0);
  }

  <code-include linkend="gpos.methods"/>
}
</code-fragment>
      <para>The base class defined a number of abstract methods to
    access the ScriptList, the FeatureList and the LookupList:</para>
      <code-fragment id="gpos.methods"><code-title>Methods to find ScriptList, FeatureList and LookupList</code-title>
  int getScriptListOffset () {
    return getOffset (4);
  }

  int getFeatureListOffset () {
    return getOffset (6);
  }

  int getLookupListOffset () {
    return getOffset (8);
  }
</code-fragment>
      <para>The most basic operation is apply a given lookup subtable to
    a given position in a glyph run. This method returns -1 if the
    subtable does not apply (i.e. its input pattern does not match the
    glyph run), or the position of first glyph following input pattern
    match.</para>
      <code-fragment id="gpos.methods"><code-title>Method to apply a GPOS subtable to a glyph</code-title>
  public LookupResult applyLookupSubtable (int lookupIndex, int lookupType,
                                           int lookupFlag, int stOffset,
					   GlyphRun gr, int curGlyph)
      throws InvalidFontException {

    switch (lookupType) {
      case 1: { <code-include linkend="gpos_1"/> }
      case 2: { <code-include linkend="gpos_2"/> }
      case 3: { <code-include linkend="gpos_3"/> }
      case 4: { <code-include linkend="gpos_4"/> }
      case 5: { <code-include linkend="gpos_5"/> }
      case 6: { <code-include linkend="gpos_6"/> }
      case 7: { return applyContextualLookupSubtable
                    (lookupIndex, lookupType, lookupFlag,
		     stOffset, gr, curGlyph); }
      case 8: { return applyChainingContextualLookupSubtable
                    (lookupIndex, lookupType, lookupFlag,
		     stOffset, gr, curGlyph); }
      case 9: { return applyExtensionLookupSubtable
                    (lookupIndex, lookupType, lookupFlag,
		     stOffset, gr, curGlyph); }
      default: {
        throw new InvalidFontException ("GPOS -" + lookupType + "-"); }}
  }
</code-fragment>
    </section>
    
