<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<section role="test-suite">
      <title>Test Suite</title>
      <code-fragment package="com.adobe.aots.CommonType" class="GposTester"><code-title>GposTester class</code-title>

  package com.adobe.aots.CommonType;

  <code-include linkend="test_imports"/>

  public class GposTester {

    <code-include linkend="test_methods"/>

    public static void main (String[] args) {
      try {
        String testName = "anonymousTest";
	URL fontURL = null;
	Font font = null;
	long script = Tag.string2tag ("latn");
	long language = Tag.string2tag ("DFLT");
	long[] features = null;
        int[] inputs= null;
	int[] components = null;
	int[] xdeltas = null;
	int[] ydeltas = null;
	int traceDepth = 3;
	String svgTraceOutput = null;
	String textTraceOutput = null;

        for (int i = 0; i &lt; args.length; i++) {
          if ("-testname".equals (args [i])) {
	    i++;
	    testName = args [i]; }

	  if ("-font".equals (args [i])) {
	    i++;
	    fontURL = new File (args [i]).getAbsoluteFile ().toURL ();
	    font = new Font ();
	    font.fromBinary (fontURL); }

	  if ("-script".equals (args [i])) {
	    i++;
	    script = Tag.string2tag (args [i]); }

	  if ("-language".equals (args [i])) {
	    i++;
	    language = Tag.string2tag (args [i]); }

	  if ("-features".equals (args [i])) {
	    i++;
	    features = Tag.string2tags (args [i]); }

	  if ("-glyphs".equals (args [i])) {
	    i++;
	    inputs = parseIntList (args [i]); }

	  if ("-components".equals (args [i])) {
	    i++;
	    components = parseIntList (args [i]); }

	  if ("-xdeltas".equals (args [i])) {
	    i++;
	    xdeltas = parseIntList (args [i]); }

	  if ("-ydeltas".equals (args [i])) {
	    i++;
	    ydeltas = parseIntList (args [i]); }

	  if ("-tracedepth".equals (args [i])) {
	    i++;
	    traceDepth = Integer.parseInt (args [i]); }

	  if ("-trace=svg".equals (args [i])) {
	    i++;
	    svgTraceOutput = args [i]; }

	  if ("-trace=text".equals (args [i])) {
	    i++;
	    textTraceOutput = args [i]; }}


        LookupTableListener listener = null;
        if (svgTraceOutput != null) {
          SVGLookupTableListener l = new SVGLookupTableListener (traceDepth);
          java.io.PrintStream out
            = new java.io.PrintStream (new java.io.FileOutputStream (svgTraceOutput));
          l.init (font, fontURL, out, false, false);
          font.gpos.setLookupTableListener (l);
          listener = l; }
        else if (textTraceOutput != null) {
          LookupTableListener l = new TextLookupTableListener (traceDepth);
          java.io.PrintStream out
            = new java.io.PrintStream (new java.io.FileOutputStream (textTraceOutput));
          l.init (font, fontURL, out, false);
          font.gpos.setLookupTableListener (l);
          listener = l; }


        GlyphRunImpl gr = new GlyphRunImpl ();
        gr.glyphs = inputs;
        gr.totGlyphs = inputs.length;

        gr.setDefaultPlacementsAndAdvances (font);

        if (font.gsub != null) {
          font.gsub.applyFeatures (script, language, features, gr); }

        if (components != null) {
          gr.setLigComponents (components); }

        font.gpos.applyFeatures (script, language, features, gr);

        if (listener != null) {
          listener.shutdown (); }

        boolean pass = true;
        if (xdeltas != null) {
          int[] actualDeltas = new int [xdeltas.length];
          for (int i = 0; i &lt; gr.glyphCount (); i++) {
            actualDeltas [i] = gr.xPos [i] - 1500 * i; }
          if (! compareIntLists (xdeltas, actualDeltas, gr.glyphCount ())) {
            pass = false;
	    System.err.println ("Incorrect xdeltas");
            System.err.print ("Wanted: ");
            for (int i = 0; i &lt; gr.glyphCount (); i++) {
              System.err.print (" " + xdeltas [i]); }
            System.err.println ();
            System.err.print ("Actual: ");
            for (int i = 0; i &lt; gr.glyphCount (); i++) {
              System.err.print (" " + actualDeltas [i]); }
            System.err.println (); }}

        if (ydeltas != null) {
          int[] actualDeltas = new int [xdeltas.length];
          for (int i = 0; i &lt; gr.glyphCount (); i++) {
             actualDeltas [i] = gr.yPos [i]; }
          if (! compareIntLists (ydeltas, actualDeltas, gr.glyphCount ())) {
            pass = false;
	    System.err.println ("Incorrect ydeltas");
            System.err.print ("Wanted: ");
            for (int i = 0; i &lt; gr.glyphCount (); i++) {
              System.err.print (" " + ydeltas [i]); }
            System.err.println ();
            System.err.print ("Actual: ");
            for (int i = 0; i &lt; gr.glyphCount (); i++) {
              System.err.print (" " + actualDeltas [i]); }
            System.err.println (); }}

        if (xdeltas != null || ydeltas != null) {
          reportStatus (testName, pass); }}

      catch (Exception e) {
        System.out.println ("Exception: " + e.getMessage ());
        e.printStackTrace (); }
    }
  }
</code-fragment>
    </section>
  
