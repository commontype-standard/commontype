<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<section xmlns:aots="http://aots.adobe.com/2001/aots" role="test-suite">
      <title>Implementation Test</title>
      <section>
        <title>context3_simple</title>
        <para>Letâ€™s start with a simple test that matches the
	  sequence [0=20] [1=21] [2=22]. At each position, we then
	  apply our standard sublookups.</para>
        <aots:context-test-font id="context3_simple_f1">
          <lookup id="lookup.test" type="contextual">
            <contextual format="3">
              <coverage glyphs="20" format="any"/>
              <coverage glyphs="21" format="any"/>
              <coverage glyphs="22" format="any"/>
              <apply pos="0" lookup="lookup.single"/>
              <apply pos="1" lookup="lookup.single"/>
              <apply pos="2" lookup="lookup.single"/>
            </contextual>
          </lookup>
        </aots:context-test-font>
        <aots:context-test id="context3_simple_t1" font="context3_simple_f1" inputs="00, 20, 21, 22, 00" outputs="00, 60, 61, 62, 00" xdeltas=" 0, 20, 20, 20,  0" ydeltas=" 0,  0,  0,  0,  0"/>
        <para>Here is a test case on the same font that involves partial
            matches input sequence:</para>
        <aots:context-test id="context3_simple_t2" font="context3_simple_f1" inputs="00, 20, 00, 20, 21, 00, 20, 21, 22, 00" outputs="00, 20, 00, 20, 21, 00, 60, 61, 62, 00" xdeltas=" 0,  0,  0,  0,  0,  0, 20, 20, 20,  0" ydeltas=" 0,  0,  0,  0,  0,  0,  0,  0,  0,  0"/>
      </section>
      <section>
        <title>context3_next_glyph</title>
        <para>Our next test verifies that the proper glyph is
          processed after a Type 5 lookup it applied. The lookup
          matches the sequence 20, 20, and applies the standard
          sublookups.</para>
        <aots:context-test-font id="context3_next_glyph_f1">
          <lookup id="lookup.test" type="contextual">
            <contextual format="3">
              <coverage glyphs="20" format="any"/>
              <coverage glyphs="20" format="any"/>
              <apply pos="0" lookup="lookup.single"/>
            </contextual>
          </lookup>
        </aots:context-test-font>
        <aots:context-test id="context3_next_glyph_t1" font="context3_next_glyph_f1" inputs="00,  20,   20,   20,   20,   20,   00" outputs="00,  60,   20,   60,   20,   20,   00" xdeltas="0,   20,    0,   20,    0,    0,    0" ydeltas="0,    0,    0,    0,    0,    0,    0"/>
      </section>
      <section>
        <title>context3_boundary</title>
        <para>Next, we test the boundary case of SubstCount equal to 0.</para>
        <aots:context-test-font id="context3_boundary_f1">
          <lookup id="lookup.test" type="contextual">
            <contextual format="3">
              <coverage glyphs="20" format="any"/>
              <coverage glyphs="20" format="any"/>
            </contextual>
          </lookup>
        </aots:context-test-font>
        <aots:context-test id="context3_boundary_t1" font="context3_boundary_f1" inputs="00,  20,   20,   20,   20,   20,   00" outputs="00,  20,   20,   20,   20,   20,   00" xdeltas="0,    0,    0,    0,    0,    0,    0" ydeltas="0,    0,    0,    0,    0,    0,    0"/>
        <para>Another boundary case is when GlyphCount is 1 (it is
          less interesting than in the other Type 5 subtable formats,
          but we may as well include it anyway).</para>
        <aots:context-test-font id="context3_boundary_f2">
          <lookup id="lookup.test" type="contextual">
            <contextual format="3">
              <coverage glyphs="20" format="any"/>
              <apply pos="0" lookup="lookup.single"/>
            </contextual>
          </lookup>
        </aots:context-test-font>
        <aots:context-test id="context3_boundary_t2" font="context3_boundary_f2" inputs="00,  20,   20,   20,   20,   20,   00" outputs="00,  60,   60,   60,   60,   60,   00" xdeltas="0,   20,   20,   20,   20,   20,    0" ydeltas="0,    0,    0,    0,    0,    0,    0"/>
      </section>
      <section>
        <title>context3_successive</title>
        <para>In this test, we verify the case described in the
	  SubstLookupRecord section. The matched sequence is 18 19
	  20 21. Glyphs 19 and 20 are replaced by glyph 23 and glyph
	  21 is replaced by glyph 24. The difficult part is that the
	  lookup that replaces 21 by 24 is applied at position 2,
	  which is counted after the ligature substitution is
	  applied.</para>
        <aots:context-test-font id="context3_successive_f1">
          <lookup id="lookup.test" type="contextual">
            <contextual format="3">
              <coverage glyphs="20" format="any"/>
              <coverage glyphs="21" format="any"/>
              <coverage glyphs="22" format="any"/>
              <coverage glyphs="23" format="any"/>
              <apply pos="1" lookup="lookup.double"/>
              <apply pos="2" lookup="lookup.single"/>
            </contextual>
          </lookup>
        </aots:context-test-font>
        <aots:context-test id="context3_successive_t1" font="context3_successive_f1" inputs="00,  20,   21,   22,  23,   00" outputs="00,  20,   61,        63,   00" xdeltas="0,    0,   20,   20,   0,    0" ydeltas="0,    0,    0,    0,   0,    0"/>
      </section>
      <section>
        <title>context3_lookupflag</title>
        <para>Our next test case involves lookupFlag. The input sequence
	  is 18 19 20, and at each position the glyphID is increased by
	  4. Glyph 26 is covered by lookupFlag.</para>
        <aots:context-test-font id="context3_lookupflag_f1">
          <lookup id="lookup.test" type="contextual" ignoreMarks="yes">
            <contextual format="3">
              <coverage glyphs="20" format="any"/>
              <coverage glyphs="21" format="any"/>
              <coverage glyphs="22" format="any"/>
              <apply pos="0" lookup="lookup.single"/>
              <apply pos="1" lookup="lookup.single"/>
              <apply pos="2" lookup="lookup.single"/>
            </contextual>
          </lookup>
        </aots:context-test-font>
        <aots:context-test id="context3_lookupflag_t1" font="context3_lookupflag_f1" inputs="00,  20,  90,  21,  91,  92,  22,   00" outputs="00,  60,  90,  61,  91,  92,  62,   00" xdeltas="0,   20,   0,  20,   0,   0,  20,    0" ydeltas="0,    0,   0,   0,   0,   0,   0,    0"/>
        <para>The interaction between LookupFlag of the contextal
	  substitution and LookupFlag of the sublookups is not very
	  clear. It is certainly desired that any glyph covered by
	  the contextual substitution LookupFlag be invisible to the
	  sublookups; what is unclear is whether this is achieved by
	  constraining legal fonts, or whether CommonType engines have
	  to enforce that behavior. Here is a font that does have
	  consistent LookupFlag, and it should behave properly with
	  all layout engines.</para>
        <aots:context-test-font id="context3_lookupflag_f2">
          <lookup id="lookup.test" type="contextual" ignoreMarks="yes">
            <contextual format="3">
              <coverage glyphs="20" format="any"/>
              <coverage glyphs="21" format="any"/>
              <coverage glyphs="22" format="any"/>
              <apply pos="1" lookup="lookup.double.nomarks"/>
            </contextual>
          </lookup>
        </aots:context-test-font>
        <aots:context-test id="context3_lookupflag_t2" font="context3_lookupflag_f2" inputs="00,  20,  90,  21,  91,  92,  22,   00" outputs="00,  20,  90,  61,  91,  92,        00" xdeltas="0,    0,   0,  20,   0,   0,   0,    0" ydeltas="0,    0,   0,   0,   0,   0,   0,    0"/>
      </section>
    </section>
  
