<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<section xmlns:web="http://aots.adobe.com/2001/web" xmlns:rng="http://relaxng.org/ns/structure/1.0" xmlns:ots="http://aots.adobe.com/2001/ots" xmlns:aots="http://aots.adobe.com/2001/aots" id="chapter.cmap">
  <title>cmap - Character to Glyph Index Mapping Table</title>
  <!--======================================================================-->
  <section role="fragment">
    <title>Introduction</title>
    <!--____________________________________________________________________-->
    <section role="specification">
      <title>Specification</title>
      <para>This table specifies how character codes in an input text should
          be mapped to glyph indices. The table may contain more than one mapping,
          to support a variety of character encoding schemes used by font consumers. Each mapping is stored in a subtable, and the table header
          indicates the character encodings for which subtables are present.
      </para>
      <section>Header</section>

      <para>The Character To Glyph Index Mapping Table begins with
        a header.</para>

      <otformat>
        <title>cmap Header</title>
        <otfield>
          <otfieldoffs>0</otfieldoffs>
          <otfieldtype>USHORT</otfieldtype>
          <otfieldname>version</otfieldname>
          <otfielddesc>Table version number (0).</otfielddesc>
        </otfield>
        <otfield>
          <otfieldoffs>2</otfieldoffs>
          <otfieldtype>USHORT</otfieldtype>
          <otfieldname>numTables</otfieldname>
          <otfielddesc>Number of encoding records.</otfielddesc>
        </otfield>
        <otfield>
          <otfieldoffs>4</otfieldoffs>
          <otfieldtype>EncodingRecord</otfieldtype>
          <otfieldname>encodingRecords[numTables]</otfieldname>
          <otfielddesc>Encoding records.</otfielddesc>
        </otfield>
      </otformat>

      <para>The encoding records specify an encoding and
    the offset to the subtable for that encoding, as follows:</para>
      <otformat>
        <title>Encoding Record</title>
        <otfield>
          <otfieldoffs>4+8i</otfieldoffs>
          <otfieldtype>USHORT</otfieldtype>
          <otfieldname>platformID</otfieldname>
          <otfielddesc>Platform ID.</otfielddesc>
        </otfield>
        <otfield>
          <otfieldoffs>4+8i+2</otfieldoffs>
          <otfieldtype>USHORT</otfieldtype>
          <otfieldname>encodingID</otfieldname>
          <otfielddesc>Platform-specific encoding ID.</otfielddesc>
        </otfield>
        <otfield>
          <otfieldoffs>4+8i+4</otfieldoffs>
          <otfieldtype>ULONG</otfieldtype>
          <otfieldname>offset</otfieldname>
          <otfielddesc>Byte offset to subtable.</otfielddesc>
        </otfield>
      </otformat>

      <para>The <link linkend="common_structures.platformencoding">platform
        ID and platform-specific encoding ID</link> values in the
          encoding record are used to specify the character repertoire and
          encoding used by the subtable.
        </para>
      <para>Subtables also contain a language ID field. For
          <ottable>cmap</ottable> subtables with platform ID 1 (Macintosh)
          which contain language-specific mappings, this ID field should be set
          to the
          <link linkend="common_structures.languageid">Macintosh language ID</link>
          of the language <emphasis>plus one</emphasis>.
          Otherwise, the language ID field must be set to zero.
        </para>
        <para>Encoding records in the cmap table header must be sorted first by
          platform ID, then by platform-specific encoding ID, and then by
          language ID in the corresponding subtable. Each platform
          ID, platform-specific encoding ID, and language ID
          combination may appear only once in the
          <ottable>cmap</ottable> table.</para>
      <para>The offset is measured from the start of the cmap table.</para>
    </section>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="xml-representation-1.xml"/>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="compiler-1.xml"/>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="decompiler-1.xml"/>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="implementation-1.xml"/>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="test-suite-1.xml"/>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="validation-1.xml"/>
  </section>
  <!--======================================================================-->
  <section role="fragment deprecated" id="cmap_cust">
    <title>OTF Windows NT compatibility mapping</title>
    <!--____________________________________________________________________-->
    <section role="specification">
      <title>Specification</title>
      <para>If a platform ID 4 (custom), encoding ID 0-255 (OTF
          Windows NT compatibility mapping) <ottable>cmap</ottable>
          encoding is present in an CommonType font with CFF outlines,
          then the OTF font driver in Windows NT will: (a) superimpose
          the glyphs encoded at character codes 0-255 in the encoding
          on the corresponding Windows ANSI (code page 1252) Unicode
          values in the Unicode encoding it reports to the system; (b)
          add Windows ANSI (CharSet 0) to the list of CharSets
          supported by the font; and (c) consider the value of the
          encoding ID to be a Windows CharSet value and add it to the
          list of CharSets supported by the font. Note: The
          <ottable>cmap</ottable> subtable must use Format 0 or 6 for
          its subtable, and the encoding must be identical to the
          CFF's encoding.</para>
      <para>This <ottable>cmap</ottable> encoding provides a
          compatibility mechanism for non-Unicode applications that use
          the font as if it were Windows ANSI encoded.</para>
    </section>
  </section>
  <!--======================================================================-->

  <section role="fragment">
    <title>cmap Subtable Formats</title>
    <para>
      XXX Introductory thing here. format 8, 10 and 12; which directly support 4-byte character
          codes. A major change introduced with these three formats is
          a more pure 32-bit orientation.
          XXX compatibility
    </para>

    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="format-0.xml"/>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="format-2.xml"/>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="format-4.xml"/>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="format-6.xml"/>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="format-8.xml"/>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="format-10.xml"/>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="format-12.xml"/>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="format-14.xml"/>
  </section>
  <!--======================================================================-->
  <section role="fragment">
    <title>Mapping Process for Font Consumers</title>
    <section role="specification">
      <title>Specification</title>

        <para>XXX</para>
        <para>When a text is being shaped by a font consumer,
          character codes that are not mapped to any glyph in the font
          by the data in this table (either because there is no subtable for their encoding or
          or because the subtable in a format not supported by the
          application or because the subtable does not contain a mapping
          for this character code) XXX unknown format
          will be mapped to glyph index
          correspond to any glyph in the font should be mapped to
          glyph index 0. The glyph at this location must be a special
          glyph representing a missing character, commonly known as
          .notdef.</para>
      </section>
  </section>

      <!--____________________________________________________________________-->
  <section role="discussion">
      <title>Discussion</title>
      <para>
        In practice, font producers creating fonts with characters entirely
        within the Basic Multilingual Plane should generate <ottable>cmap</ottable>
        table entries with Unicode codepoint encoding using platform ID 0
        platform encoding ID 3, and platform ID 3 platform encoding 1. Character
        to glyph ID assignments compatible with the MacRoman encoding should be
        made using platform ID 1 platform encoding 0.
      </para>
      <para>All Microsoft Unicode encodings (Platform ID = 3,
          Encoding ID = 1) must provide at least a Format 4
          <ottable>cmap</ottable> subtable. If the font is meant to
          support supplementary Unicode characters, it will additionally
          need a Format 12 subtable with a platform encoding ID 10.
          The contents of the Format 12 subtable need to be a superset
          of the contents of the Format 4 subtable. Microsoft
          <emphasis>strongly</emphasis> recommends using a Unicode
          <ottable>cmap</ottable> for all fonts.</para>

      <para>Unicode Variation Sequences supported by the font may be
        specified in the cmap table under platform ID 0 and encoding
        ID 5, using a format 14 cmap subtable.</para>

      <para>It is legal to have a single subtable which is referenced
          from multiple entries? This is useful when a given character
          encoding is present on multiple platforms. For example, if
          there is a Unicode cmap subtable, it can be referenced from
          one entry with platformID/encodingID (0, 3), and from
          another entry with (3, 1).</para>
          <para>
          The language field   For example, a Mac OS Turkish
          <ottable>cmap</ottable> subtable must set this field to 18,
          since the Macintosh language ID for Turkish is 17. A Mac OS
          Roman <ottable>cmap</ottable> subtable must set this field
          to 0, since Mac OS Roman is not a language-specific
          encoding.</para>

    </section>

  <!--======================================================================-->
  <section role="fragment">
    <title>Various test fonts</title>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="test-suite-10.xml"/>
  </section>
</section>
