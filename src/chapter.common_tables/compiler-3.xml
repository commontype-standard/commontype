<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<section role="compiler">
      <title>Compiler</title>
      <code-fragment id="lookuptable.methods">
  private Block langSysTableFromXML (Element t, Element table,
                                     Map&lt;Element, Block&gt; blockCache,
				     Map&lt;String, Integer&gt; featureIndices)
      throws InvalidFontException, UnsupportedFontException {

    { String name = t.getAttribute ("name");
      if (name != null &amp;&amp; ! "".equals (name)) {
        t = resolveXMLid (table, name); }}

    { Block cached = blockCache.get (t);
      if (cached != null) {
        return cached; }}

    NodeList features = t.getChildNodes ();

    Element requiredFeature = null;
    if (features.getLength () &gt; 0
        &amp;&amp; "requiredFeature".equals (((Element)features.item (0)).getTagName ())) {
      requiredFeature = (Element) features.item (0);
      t.removeChild (requiredFeature);
      features = t.getChildNodes (); }

    int featureCount = features.getLength ();

    Block me = new Block (6 + 2 * featureCount, 1);
    blockCache.put (t, me);

    me.setOffset (0, null);

    if (requiredFeature == null) {
      me.setuint16 (2, 0xffff); }
    else {
      String featureName = requiredFeature.getAttribute ("name");
      Integer ii = featureIndices.get (featureName);
      if (ii == null) {
        warning ("Cannot resolve '" + featureName + "'"); }
      else {
        me.setuint16 (2, ii.intValue ()); }}
    me.setuint16 (4, featureCount);
    for (int i = 0; i &lt; featureCount; i++) {
      Element feature = (Element) features.item (i);
      String featureName = feature.getAttribute ("name");
      Integer ii = featureIndices.get (featureName);
      if (ii == null) {
        warning ("cannot resolve '" + featureName + "'"); }
      else {
        me.setuint16 (6 + 2*i, ii.intValue ()); }}

    return me;
  }
</code-fragment>
    </section>
    
